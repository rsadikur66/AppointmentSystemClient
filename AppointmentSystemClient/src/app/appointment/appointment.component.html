<table>
  <tr>
    <td><label>Select Patient :</label></td>
    <td>
      <mat-form-field appearance="fill">
        <mat-label>Select Patient</mat-label>
        <mat-select [(ngModel)]="appointment.patientId" name="patientId">
          <mat-option *ngFor="let p of patients" [value]="p.patientId">
            {{ p.patientName }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </td>
  </tr>

  <tr>
    <td><label>Select Doctor :</label></td>
    <td>
      <mat-form-field appearance="fill">
        <mat-label>Select Doctor</mat-label>
        <mat-select [(ngModel)]="appointment.doctorId" name="doctorId">
          <mat-option *ngFor="let d of doctors" [value]="d.doctorId">
            {{ d.fullName }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </td>
  </tr>

  <tr>
    <td><label>Appointment Date :</label></td>
    <td>
      <mat-form-field appearance="fill">
        <mat-label>Choose a date</mat-label>
        <input matInput [matDatepicker]="picker" [(ngModel)]="appointment.appointmentDate" name="appointmentDate">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </td>
  </tr>

  <tr>
    <td><label>Visit Type:</label></td>
    <td>
      <mat-radio-group [(ngModel)]="appointment.visitType" name="visitType">
        <mat-radio-button value="1">First Visit</mat-radio-button>
        <mat-radio-button value="2">Follow-up</mat-radio-button>
      </mat-radio-group>
    </td>
  </tr>

  <tr>
    <td><label>Notes:</label></td>
    <td>
      <mat-form-field appearance="fill">
        <mat-label>Notes</mat-label>
        <input matInput [(ngModel)]="appointment.notes" name="notes">
      </mat-form-field>
    </td>
  </tr>

  <tr>
    <td><label>Diagnosis:</label></td>
    <td>
      <mat-form-field appearance="fill">
        <mat-label>Diagnosis</mat-label>
        <textarea matInput [(ngModel)]="appointment.diagnosis" name="diagnosis"></textarea>
      </mat-form-field>
    </td>
  </tr>

  <tr>
    <td>
      <button mat-raised-button color="primary" (click)="onInsert()">Insert</button>
    </td>
  </tr>
</table>

<!-- <div class="row">
  <table mat-table [dataSource]="appointments" class="mat-elevation-z8">
  <ng-container matColumnDef="patientName">
    <th mat-header-cell *matHeaderCellDef>Patient</th>
    <td mat-cell *matCellDef="let element">{{element.patientName}}</td>
  </ng-container>

  <ng-container matColumnDef="doctorName">
    <th mat-header-cell *matHeaderCellDef>Doctor</th>
    <td mat-cell *matCellDef="let element">{{element.doctorName}}</td>
  </ng-container>

  <ng-container matColumnDef="appointmentDate">
    <th mat-header-cell *matHeaderCellDef>Date</th>
    <td mat-cell *matCellDef="let element">{{element.appointmentDate | date}}</td>
  </ng-container>

  <ng-container matColumnDef="visitType">
    <th mat-header-cell *matHeaderCellDef>Visit Type</th>
    <td mat-cell *matCellDef="let element">{{element.visitType}}</td>
  </ng-container>

    <ng-container matColumnDef="notes">
    <th mat-header-cell *matHeaderCellDef>Notes</th>
    <td mat-cell *matCellDef="let element">{{element.notes}}</td>
  </ng-container>

  <ng-container matColumnDef="diagnosis">
    <th mat-header-cell *matHeaderCellDef>Diagnosis</th>
    <td mat-cell *matCellDef="let element">{{element.diagnosis}}</td>
  </ng-container>



  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Actions</th>
    <td mat-cell *matCellDef="let element">
      <button mat-button color="primary" (click)="onEdit(element)">Edit</button>
      <button mat-button color="warn" (click)="onDelete(element)">Delete</button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
</table>

<mat-paginator [length]="totalAppointments"
               [pageSize]="pageSize"
               [pageSizeOptions]="[5, 10, 25, 50]"
               (page)="onPageChange($event)">
</mat-paginator>

</div> -->

  <div class="row">
    <mat-form-field appearance="outline">
  <mat-label>Search</mat-label>
  <input matInput (keyup)="applyFilter($event)" placeholder="Search appointments">
</mat-form-field>
  <table mat-table [dataSource]="dataSource"  class="mat-elevation-z8">
    
     
    <!-- Appointment ID Column -->
    <ng-container matColumnDef="appointmentId">
      <th mat-header-cell *matHeaderCellDef>ID</th>
      <td mat-cell *matCellDef="let element">{{element.appointmentId}}</td>
    </ng-container>

    <!-- Patient Column -->
    <ng-container matColumnDef="patientName">
      <th mat-header-cell *matHeaderCellDef>Patient</th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngIf="editedRow !== element.appointmentId; else editPatient">
          {{element.patientName}}
        </ng-container>
        <ng-template #editPatient>
          <mat-form-field appearance="fill">
        <mat-select [(ngModel)]="element.patientId">
          <mat-option *ngFor="let p of patients" [value]="p.patientId">
            {{p.patientName}}
          </mat-option>
        </mat-select>
      </mat-form-field>
        </ng-template>
      </td>
    </ng-container>

    <!-- Doctor Column -->
    <ng-container matColumnDef="doctorName">
      <th mat-header-cell *matHeaderCellDef>Doctor</th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngIf="editedRow !== element.appointmentId; else editDoctor">
          {{element.doctorName}}
        </ng-container>
        <ng-template #editDoctor>
          <mat-form-field appearance="fill">
        <mat-select [(ngModel)]="element.doctorId">
          <mat-option *ngFor="let d of doctors" [value]="d.doctorId">
            {{d.fullName}}
          </mat-option>
        </mat-select>
      </mat-form-field>
        </ng-template>
      </td>
    </ng-container>

    <!-- Date Column -->
    <!-- Appointment Date Column -->
<ng-container matColumnDef="appointmentDate">
  <th mat-header-cell *matHeaderCellDef>Date</th>
  <td mat-cell *matCellDef="let element">
    <ng-container *ngIf="editedRow !== element.appointmentId; else editDate">
      {{ element.appointmentDate | date:'medium' }}
    </ng-container>
    <ng-template #editDate>
      <mat-form-field appearance="fill">
        <input matInput [matDatepicker]="picker" [(ngModel)]="element.appointmentDate">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </ng-template>
  </td>
</ng-container>


    <!-- Visit Type Column -->
    <ng-container matColumnDef="visitType">
      <th mat-header-cell *matHeaderCellDef>Visit Type</th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngIf="editedRow !== element.appointmentId; else editVisitType">
          {{element.visitType === '1' ? 'First Visit' : 
            element.visitType === '2' ? 'Follow-up' : element.visitType}}
        </ng-container>
        <ng-template #editVisitType>
          <select matInput [(ngModel)]="element.visitType" name="visitType" required>
            <option value="" disabled selected>-- Select Visit Type --</option>
            <option value="1">First Visit</option>
            <option value="2">Follow-up</option>
            
          </select>
          <div *ngIf="!element.visitType">
  <span style="color:red">Visit Type is required.</span>
</div>
        </ng-template>
      </td>
    </ng-container>

    <!-- Notes Column -->
    <ng-container matColumnDef="notes">
      <th mat-header-cell *matHeaderCellDef>Notes</th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngIf="editedRow !== element.appointmentId; else editNotes">
          {{element.notes}}
        </ng-container>
        <ng-template #editNotes>
          <textarea matInput [(ngModel)]="element.notes" rows="2"></textarea>
        </ng-template>
      </td>
    </ng-container>

    <!-- Diagnosis Column -->
    <ng-container matColumnDef="diagnosis">
      <th mat-header-cell *matHeaderCellDef>Diagnosis</th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngIf="editedRow !== element.appointmentId; else editDiagnosis">
          {{element.diagnosis}}
        </ng-container>
        <ng-template #editDiagnosis>
          <textarea matInput [(ngModel)]="element.diagnosis" rows="2"></textarea>
        </ng-template>
      </td>
    </ng-container>

    <!-- Created At Column -->
    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef>Created At</th>
      <td mat-cell *matCellDef="let element">{{element.createdAt | date:'medium'}}</td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let element">
        <ng-container *ngIf="editedRow !== element.appointmentId">
          <button mat-icon-button color="primary" (click)="startEdit(element)" title="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="onDelete(element)" title="Delete">
            <mat-icon>delete</mat-icon>
          </button>
          <button mat-icon-button color="accent" (click)="openMedicineDialog(element)">
      <mat-icon>medical_services</mat-icon>
    </button>
        </ng-container>
        <ng-container *ngIf="editedRow === element.appointmentId">
          <button mat-icon-button color="accent" (click)="saveEdit(element)" title="Save">
            <mat-icon>save</mat-icon>
          </button>
          <button mat-icon-button (click)="cancelEdit()" title="Cancel">
            <mat-icon>cancel</mat-icon>
          </button>
           
        </ng-container>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    
  </table>

  <mat-paginator [length]="totalAppointments"
                 [pageSize]="pageSize"
                 [pageSizeOptions]="[5, 10, 25, 50]"
                 (page)="onPageChange($event)">
  </mat-paginator>
</div>

<!-- git successfull -->